/*! wpp-contact-downloader 2020-03-21 */

$(document).ready(function(){chrome.runtime.onConnect.addListener(e=>{"default-conn"==e.name&&e.onMessage.addListener(t=>{"loadData"==t.command&&function(){let t=$(".X7YrQ ._2UaNq._3mMX1"),n={profile_pic:t.find("img.jZhyM._13Xdg._F7Vk").attr("src"),name:t.find("._2WP9Q ._3NWy8 span").attr("title")},i=[];$(".message-in").filter(function(){return $(this).find("._2qE0x.copyable-text").find("._3RWII").find("img").length}).each(function(){let e=$(this).find("img").attr("src")||"",t=new URL(e).searchParams.get("u")||"",n=$(this).find(".nUQs8 ._2LRBk.selectable-text").text();i.push({profile_pic:e,name:n,number:t,email:""})}),$(".message-in").filter(function(){return $(this).find(".CqLtL").find("._3j7-G").length}).each(function(){$(this).find("._1PENu .Ir_Ne").click();let e=$(".app-wrapper-web").find("span ._2t4Ic"),t=e.find("header .qfKkX");e.css("display","none");let n=function(e){let t=[];return e.find(".rK2ei ._1v8mQ").each(function(){let e=$(this),n={profile_pic:e.find("img").attr("src")||"",name:e.find("._3H4MS span").attr("title"),number:"",email:""},i=e.find("._1VwzF ._22OEK ._F7Vk").text();/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(i).toLowerCase())?n.email=i:n.number=i,t.push(n)}),t}(e);$.merge(i,n),t.click()}),e.postMessage({command:"updateData",data:{user:n,contact_list:i}})}()})})});