/*! wpp-contact-downloader 2020-03-21 */

function downloadFile(t,e){let n=new Blob([e],{type:"text/csv"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(n,t);else{let e=window.document.createElement("a");e.href=window.URL.createObjectURL(n),e.download=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}}$(document).ready(()=>{function t(t,e){let n=$(t);(e=void 0===e?n.hasClass("checked"):!e)?(n.removeClass("checked"),n.find("span").attr("class","mdi mdi-checkbox-blank-outline")):(n.addClass("checked"),n.find("span").attr("class","mdi mdi-checkbox-marked"));let c=$("#contact-list .list .contact").filter(function(){return $(this).find(".select-item.checkbox").hasClass("checked")}).length;return $("#selected-contact-count").text(c),!e}chrome.tabs.query({active:!0,currentWindow:!0},e=>{const n=chrome.tabs.connect(e[0].id,{name:"default-conn"});$("#loading-overlay").show(),n.postMessage({command:"loadData"}),n.onMessage.addListener(e=>{"updateData"==e.command&&function(e){let{user:n,contact_list:c}=e;if(!n.name)return;$("#content").slideDown(300),$("#profile-pic").attr("src",n.profile_pic),$("#profile-name").text(n.name),c.length>0?$(".contact-count").removeClass("empty"):$(".contact-count").hasClass("empty")||$(".contact-count").addClass("empty");$("#contact-count").text(c.length);const a=$("#contact-list"),o=a.find("header .select-all .checkbox");a.hide();for(let e=0;e<c.length;e++){let n=c[e],i=$('<div class="contact"></div>');i.data("contact-index",e),i.append(`\n                <img src="${n.profile_pic||"img/profile-pic.jpeg"}" alt="" class="profile-pic" />\n                <div class="content">\n                    <p class="name">${n.name}</p>\n                    <p class="number">${n.number}</p>\n                    <p class="email">${n.email}</p>\n                </div>\n            `);let l=$('<div class="actions"></div>'),s=$('\n                <button class="btn icon select-item checkbox">\n                    <span class="mdi mdi-checkbox-blank-outline"></span>\n                </button>\n            ');l.append(s),i.append(l),a.find(".list").append(i),s.click(function(){t(this)||t(o,!1),a.find(".contact .checkbox.checked").length===a.find(".contact .checkbox").length&&t(o,!0)})}o.click(function(){let e=t(this);a.find(".list .contact").each(function(){t($(this).find(".checkbox"),e)})}).click(),c.length>0?$("#actions, #contact-list").slideDown():$("#actions, #contact-list").hide();$("#loading-overlay").fadeOut(),$("#download-btn").click(function(){let t=[];$("#contact-list .list .contact").filter(function(){return $(this).find(".select-item.checkbox").hasClass("checked")}).each(function(){t.push(c[$(this).data("contact-index")])});let e="";for(let n=0;n<t.length;n++){let c=t[n];e+=`${c.name},${c.number},${c.email}\r\n`}let n=prompt("Please enter a filename to save","contacts");""==n&&(n="contacts"),null!=n&&downloadFile(`${n}.csv`,e)})}(e.data)}),$("#refresh-btn").click(()=>{location.reload()})})}),function(){function t(t,e,n){return new Promise(c=>{t.call(chrome.tabs,e,n,t=>c())})}window.ScriptExecution=class{constructor(t){this.tabId=t}executeScripts(e){return e=Array.prototype.slice.call(arguments),Promise.all(e.map(e=>(function(e,n){let c={file:n,runAt:"document_end"};return t(chrome.tabs.executeScript,e,c)})(this.tabId,e))).then(()=>this)}executeCodes(e){return e=Array.prototype.slice.call(arguments),Promise.all(e.map(e=>(function(e,n){let c={code:n,runAt:"document_end"};return t(chrome.tabs.executeScript,e,c)})(this.tabId,e))).then(()=>this)}injectCss(e){return e=Array.prototype.slice.call(arguments),Promise.all(e.map(e=>(function(e,n){let c={file:n,runAt:"document_end"};return t(chrome.tabs.insertCSS,e,c)})(this.tabId,e))).then(()=>this)}}}();